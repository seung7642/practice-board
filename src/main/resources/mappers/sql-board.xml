<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "mybatis-3-mapper.dtd">

<mapper namespace="com.practice.board.application.board.dao.BoardMapper">
    <select id="getArticle" resultType="Board" parameterType="Integer">
        SELECT
              idx
            , title
            , content
            , reg_date
            , upd_date
            , hits
        FROM
            practice_board.BOARD_TBL
        WHERE
            idx = #{idx}
    </select>

    <select id="getArticleList" resultType="Board" parameterType="Criteria">
        SELECT
              idx
            , title
            , content
            , writer
            , reg_date
            , upd_date
            , hits
        FROM
            practice_board.BOARD_TBL as outside
        JOIN (
            SELECT idx
            FROM practice_board.BOARD_TBL
            WHERE reg_date > '1970-01-01'
            ORDER BY idx DESC
            LIMIT #{startRowNumber}, 10
        ) as sub
        ON outside.idx = sub.idx
    </select>

    <select id="getArticleCount" resultType="Integer">
        SELECT
            COUNT(*)
        FROM
            practice_board.BOARD_TBL
    </select>

    <insert id="insertArticle" parameterType="Board" useGeneratedKeys="true" keyProperty="idx">
        INSERT INTO BOARD_TBL (
              title
            , content
            , writer
            , reg_date
        ) VALUES (
              #{title}
            , #{content}
            , #{writer}
            , NOW()
        )
    </insert>

    <update id="updateHits" parameterType="Integer">
        UPDATE
            BOARD_TBL
        SET
            hits = hits + 1
        WHERE
            idx = #{idx}
    </update>
</mapper>